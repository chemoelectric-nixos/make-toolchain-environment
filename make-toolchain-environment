#!/usr/bin/env nix-shell
#! nix-shell --pure -i zsh -p zsh coreutils

progname=`basename ${0}`

print_usage ()
{
    echo "Usage: ${progname} of-symlinks dir1 dir2 ... dirN environ-dir"
    echo "       ${progname} blahblah xxxxxxxxxxxxxxx"
}

make_symlinks ()
{
    if [[ 2 -le $# ]]; then
        local destination source files
        destination="${@[-1]}"
        for source in "${@[1,-2]}"; do
            # List the files in each source directory, including
            # hidden files.
            files=`ls --almost-all "${source}"/.`
            if [[ -n "${files}" ]]; then
                # For each of those files, approximate its structure,
                # using directories and symlinks. But do not clobber
                # anything that has already been made.
                for f in ${files}; do
                    cp --recursive --symbolic-link --update=none \
                       "${source}"/"${f}" "${destination}"/.
                done

            fi
        done
    fi
}

if [[ "${1}" == "" ]]; then
    print_usage
    exit 1
fi

make_symlinks a b c d e f

exit 0

# local variables:
# mode: shell-script
# sh-shell: zsh;
# indent-tabs-mode: nil
# end:
